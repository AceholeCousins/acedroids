<html>
<head>

<script src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>
<script src="src/utils/tools.js"></script>
<script src="src/utils/touch.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  touch-action: none;
}
div{
	position:absolute;
	display:inline-block;
	background-color:yellow;
}
body{
	overflow:hidden;
	background-color:black;
}
</style>
</head>

<body onLoad="init()">

<!-- joystick -->
<div id="controller0">
	<div id="joyarea" class="touchable" data-movecallback="moveStick" data-upcallback="releaseStick">
		<div id="joystick" style="pointer-events:none; background-color:red;"></div>
	</div>
	<div id="joytrigger" class="touchable" data-downcallback="startFiring" data-upcallback="stopFiring"></div>
</div>

<!-- touchpad -->
<div id="controller1">
	<div id="touchpad" class="touchable"></div>
	<div id="touchtrigger" class="touchable" data-downcallback="startFiring" data-upcallback="stopFiring"></div>
</div>

<!-- marble -->
<div id="controller2">
	<div id="marbletrigger1" class="touchable" data-downcallback="startFiring" data-upcallback="stopFiring"></div>
	<div id="marbletrigger2" class="touchable" data-downcallback="startFiring" data-upcallback="stopFiring"></div>
</div>

<div id="status"></div>

<div id="changecontroller">Change Controller</div>

<div class="touchable" data-downcallback="left" style="left:100px; width:80px; height:80px">&lt;&lt;</div>
<div class="touchable" data-downcallback="go" style="left:200px; width:80px; height:80px">GO!</div>
<div class="touchable" data-downcallback="right" style="left:300px; width:80px; height:80px">&gt;&gt;</div>

<script>

var dimensions = {}
var airConsole
var activeController = 0

dimensions.w = 800
dimensions.h = 600

Touch.init()

function init(){
	airConsole = new AirConsole({"orientation": "landscape"})
}

Touch.callbacks.startFiring = function(){
	console.log("fire")
	airConsole.message(AirConsole.SCREEN, ["f", 1])
}

Touch.callbacks.stopFiring = function(){
	console.log("stopfire")
	airConsole.message(AirConsole.SCREEN, ["f", 0])
}

Touch.callbacks.left = function(){
	console.log("left")
	airConsole.message(AirConsole.SCREEN, "l")
}

Touch.callbacks.right = function(){
	console.log("right")
	airConsole.message(AirConsole.SCREEN, "r")
}

Touch.callbacks.go = function(){
	console.log("go")
	airConsole.message(AirConsole.SCREEN, "g")
}

Touch.callbacks.moveStick = function(mx, my){
	var x = mx-dimensions.joyHomeX
	var y = my-dimensions.joyHomeY
	var rq = x*x + y*y
	if(rq > dimensions.joyRange*dimensions.joyRange){
		var r = Math.sqrt(rq)
		x = x/r*dimensions.joyRange
		y = y/r*dimensions.joyRange
	}
	reposition("joystick", x + dimensions.joyRange, y + dimensions.joyRange)
}

Touch.callbacks.releaseStick = function(){
	reposition("joystick", dimensions.joyRange, dimensions.joyRange)
}

function steer(thrust, direction){
	airConsole.message(AirConsole.SCREEN, ["s", thrust, direction])
}

window.onresize = function(){
	dimensions.w = window.innerWidth
	dimensions.h = window.innerHeight

	dimensions.tile = Math.min(dimensions.w/3.0, dimensions.h)
	dimensions.joyHomeX = dimensions.tile*0.5
	dimensions.joyHomeY = dimensions.h*0.5
	dimensions.joyDiam = dimensions.tile*0.4
	dimensions.joyRange = (dimensions.tile - dimensions.joyDiam)*0.5
	dimensions.triggerDiam = dimensions.tile*0.8

	reposition("joyarea",
			dimensions.joyHomeX - dimensions.joyRange-dimensions.joyDiam*0.5,
			dimensions.joyHomeY - dimensions.joyRange-dimensions.joyDiam*0.5,
			dimensions.tile,
			dimensions.tile)
	reposition("joystick",
			dimensions.joyRange,
			dimensions.joyRange,
			dimensions.joyDiam,
			dimensions.joyDiam)
	reposition("joytrigger",
			dimensions.w-dimensions.tile,
			(dimensions.h-dimensions.tile)*0.5,
			dimensions.tile,
			dimensions.tile)
	reposition("changecontroller",
			dimensions.tile,
			dimensions.h - dimensions.tile*0.2,
			dimensions.tile,
			dimensions.tile*0.2)
}
window.onresize()
</script>

</body>
</html>
