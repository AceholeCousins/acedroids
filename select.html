
<html><head><title>AceDroids:Configuration</title>
<meta charset="utf-8">
<style type="text/css">
.std {
	box-shadow: 1px 1px 4px #404850;
	margin: 2px;
	border-style:none;
	border-width:2px;
	border-radius:3px;
	border-color:#808080;
	font-size:13pt;
	font-family:sans-serif;
	background-color:#f0f8ff;
}
body { 
  background: url(media/images/vs.jpg) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
	font-size:13pt;
	font-family:sans-serif;
}
button{
	overflow: hidden;
}
</style>

</head><body>

<script>

/////////////////////////
// HTML for one player //
/////////////////////////

var playerDisplayTemplate = `
<table id="table_$" class="std" style="padding:7px; background-color:white; border-color:#cccccc; height:210px">
 <tr>
  <td id="vehicle_$" align="center">
   <div id="picbg_$" style="width:160px; height:120px; background-color:#ff0000">
    <img src="media/images/darken.png" style="width:100%; height:100%;">
    <img src="media/images/lighten.png" style="position:relative; top:-100%; width:100%; height:100%;">
   </div>
   <input id="name_$" class="std" style="width:160px; text-align:center" value=""><br>
   <select id="color_$" class="std" style="width:160px"
        onchange="get('picbg_'+idx(this)).style.backgroundColor=this.value">
   </select><br>
  </td>
  <td id="ctltype_$" align="center">
   <img id="ctlgp_$" class="std" src="media/images/gamepad.png" style="width:60px;"
	onclick="ctlSelect(idx(this), 'gp')">
   <img id="ctlkb_$" class="std" src="media/images/keyboard.png" style="width:60px;"
	onclick="ctlSelect(idx(this), 'kb')"><br>
   <img id="ctlms_$" class="std" src="media/images/mouse.png" style="width:60px;"
	onclick="ctlSelect(idx(this), 'ms')"><br><br>
   <button id="remove_$" class="std" style="background-color:#ffdddd"
        onclick="get('disparea').removeChild(get('playerbox_' + idx(this)))">Remove Player
   </button>
  </td>
  <td id="ctloptions_$" align="right" style="width:200px;">
   <div id="gpoptions_$">
	Pad #: <select id="gpidx_$" class="std" style="width:100px;"></select><br>
	Control: <select id="gprelabs_$" class="std" style="width:100px;">
	 <option>Relative</option>
	 <option>Absolute</option>
	</select><br>
	Left/Right: <select id="gplr_$" class="std" style="width:100px;"></select><br>
	Up/Down: <select id="gpud_$" class="std" style="width:100px;"></select><br>
	Thrust: <select id="gpthrust_$" class="std" style="width:100px;"></select><br>
	Fire: <select id="gpfire_$" class="std" style="width:100px;"></select><br>
	Special: <select id="gpspcl_$" class="std" style="width:100px;"></select>
   </div>
   <div id="kboptions_$">
	Control: <select id="kbrelabs_$" class="std" style="width:100px;">
	 <option>Relative</option>
	 <option>Absolute</option>
	</select><br>
	Left/Right: <button id="kbl_$" class="std" style="width:48px;"
		onclick="assignKey(this)">&nbsp
		</button><button id="kbr_$" class="std" style="width:48px;"
		onclick="assignKey(this)">&nbsp</button><br>
	Up/Down: <button id="kbu_$" class="std" style="width:48px;"
		onclick="assignKey(this)">&nbsp
		</button><button id="kbd_$" class="std" style="width:48px;"
		onclick="assignKey(this)">&nbsp</button><br>
	Thrust: <button id="kbthrust_$" class="std" style="width:100px;"
		onclick="assignKey(this)">&nbsp</button><br>
	Fire: <button id="kbfire_$" class="std" style="width:100px;"
		onclick="assignKey(this)">&nbsp</button><br>
	Special: <button id="kbspcl_$" class="std" style="width:100px;"
		onclick="assignKey(this)">&nbsp</button>
   </div>
   <div id="msoptions_$">
	Control: <select id="msrelabs_$" class="std" style="width:100px;">
	 <option>Relative</option>
	 <option>Absolute</option>
	</select><br>
	Thrust: <select id="msthrust_$" class="std" style="width:100px;">
	 <option data-code="l">L Button</option>
	 <option data-code="r">R Button</option>
	</select><br>
	Fire: <select id="msfire_$" class="std" style="width:100px;">
	 <option data-code="l">L Button</option>
	 <option data-code="r">R Button</option>
	</select><br>
	Special: <select id="msspcl_$" class="std" style="width:100px;">
	 <option data-code="lr">L+R simult.</option>
	 <option data-code="wp">Wheel press</option>
	 <option data-code="ws">Wheel scroll</option>
	</select><br>
   </div>
  </td>
 </tr>
</table>
`;

/*
   <div id="kboptions_$">
	Control: <select id="kbrelabs_$" class="std" style="width:100px;">
	 <option>Relative</option>
	 <option>Absolute</option>
	</select><br>
	Left/Right: <select id="kbl_$" class="std" style="width:48px;">
		</select><select id="kbr_$" class="std" style="width:48px;"></select><br>
	Up/Down: <select id="kbu_$" class="std" style="width:48px;">
		</select><select id="kbd_$" class="std" style="width:48px;"></select><br>
	Thrust: <select id="kbthrust_$" class="std" style="width:100px;"></select><br>
	Fire: <select id="kbfire_$" class="std" style="width:100px;"></select><br>
	Special: <select id="kbspcl_$" class="std" style="width:100px;"></select>
   </div>
*/



////////////////
// add player //
////////////////

var playerIndex = 0;

function addPlayer(){
	var p = make("p");
	p.id = "playerbox_" + playerIndex;
	get("disparea").insertBefore(p, get("disparea").childNodes[0]);
	var html = playerDisplayTemplate.replaceAll("$", playerIndex);
	p.innerHTML = html;

	for(var i=0; i<colors.length; i++){
		opt = make("option");
		opt.appendChild(txt(colors[i]));
		opt.style.backgroundColor = colors[i];
		get("color_" + playerIndex).appendChild(opt);
	}
	var c = get("color_" + playerIndex);
	c.selectedIndex = randint(colors.length);
	get("picbg_" + playerIndex).style.backgroundColor = c.value;
	get("name_" + playerIndex).value = names[randint(names.length)];

	for(var i=1; i<=127; i++){
		opt = make("option");
		opt.appendChild(txt(i));
		get("gpidx_" + playerIndex).appendChild(opt);
	}
	fillOptions(get("gplr_" + playerIndex), axespm, axcode);
	fillOptions(get("gpud_" + playerIndex), axespm, axcode);
	fillOptions(get("gpthrust_" + playerIndex), axeshalf.concat(buttons), axcode.concat(butcode));
	fillOptions(get("gpfire_" + playerIndex), buttons, butcode);
	fillOptions(get("gpspcl_" + playerIndex), buttons, butcode);

	ctlSelect(playerIndex, "kb");

	get("gplr_" + playerIndex).selectedIndex = 0;
	get("gpud_" + playerIndex).selectedIndex = 2;
	get("gpthrust_" + playerIndex).selectedIndex = 19;
	get("gpfire_" + playerIndex).selectedIndex = 0;
	get("gpspcl_" + playerIndex).selectedIndex = 2;

	get("kbl_" + playerIndex).dataset.code = 65;
	get("kbl_" + playerIndex).innerHTML = keyNames[65];
	get("kbr_" + playerIndex).dataset.code = 68;
	get("kbr_" + playerIndex).innerHTML = keyNames[68];		
	get("kbthrust_" + playerIndex).dataset.code = 87;
	get("kbthrust_" + playerIndex).innerHTML = keyNames[87];
	get("kbfire_" + playerIndex).dataset.code = 32;
	get("kbfire_" + playerIndex).innerHTML = keyNames[32];
	get("kbspcl_" + playerIndex).dataset.code = 17;
	get("kbspcl_" + playerIndex).innerHTML = keyNames[17];

	get("msthrust_" + playerIndex).selectedIndex = 1;

	playerIndex++;
}

//////////////////////
// helper functions //
//////////////////////

function get(id){return document.getElementById(id);}
function make(tag){return document.createElement(tag);}
function txt(str){return document.createTextNode(str);}
String.prototype.replaceAll = function(search, replacement){var target = this; return target.split(search).join(replacement);};
function idx(self){return self.id.split("_")[1];} // return index of an html element
function randint(maximum){return Math.floor(Math.random()*maximum);}

function fillOptions(select, options, code){
	for(var i=0; i<options.length; i++){
		opt = make("option");
		opt.appendChild(txt(options[i]));
		opt.dataset.code = code[i];
		select.appendChild(opt);
	}
}

function ctlSelect(index, element){ // takes the player index and "gp/ms/kb"
	get("gpoptions_" + index).style.display = "none";
	get("msoptions_" + index).style.display = "none";
	get("kboptions_" + index).style.display = "none";
	get(element + "options_" + index).style.display = "inline";
	
	get("ctlgp_" + index).style.backgroundColor = "#f0f8ff";
	get("ctlms_" + index).style.backgroundColor = "#f0f8ff";
	get("ctlkb_" + index).style.backgroundColor = "#f0f8ff";
	get("ctl" + element + "_" + index).style.backgroundColor = "skyblue";

	get("ctltype_" + index).dataset.selected = element;
}

var assignKeyToButton='';
function assignKey(button){
	assignKeyToButton = button;
	button.style.backgroundColor = "yellow";
}
document.body.onkeydown = function(e){
	if(assignKeyToButton != ''){
		e.preventDefault();
		assignKeyToButton.innerHTML = keyNames[e.keyCode] || "k" + e.keyCode;
		assignKeyToButton.dataset.code = e.keyCode;
		assignKeyToButton.style.backgroundColor = "#f0f8ff";
		assignKeyToButton='';
	}
}

function config2string(complete){ // incomplete does not contain key mappings for unselected control types
	var result = '';
	var relabs = ['rel', 'abs'];
	var ctl = '';

	for(var i=0; i<get("disparea").childNodes.length; i++){
		var index = idx(get("disparea").childNodes[i]);
		result += "player:" + get("name_"+index).value + ",";
		result += get("color_"+index).value + ",";
		ctl = get("ctltype_"+index).dataset.selected;
		result += ctl;

		if(ctl == "gp" || complete){
			result += ",";
			result += get("gpidx_" + index).value + ",";
			result += relabs[get("gprelabs_" + index).selectedIndex] + ",";
			result += get("gplr_" + index).options[get("gplr_" + index).selectedIndex].dataset.code + ",";
			result += get("gpud_" + index).options[get("gpud_" + index).selectedIndex].dataset.code + ",";
			result += get("gpthrust_" + index).options[get("gpthrust_" + index).selectedIndex].dataset.code + ",";
			result += get("gpfire_" + index).options[get("gpfire_" + index).selectedIndex].dataset.code + ",";
			result += get("gpspcl_" + index).options[get("gpspcl_" + index).selectedIndex].dataset.code;
		}
		if(ctl == "kb" || complete){
			result += ",";
			result += relabs[get("kbrelabs_" + index).selectedIndex] + ",";
			result += get("kbl_" + index).dataset.code + ",";
			result += get("kbr_" + index).dataset.code + ",";
			result += get("kbu_" + index).dataset.code + ",";
			result += get("kbd_" + index).dataset.code + ",";
			result += get("kbthrust_" + index).dataset.code + ",";
			result += get("kbfire_" + index).dataset.code + ",";
			result += get("kbspcl_" + index).dataset.code;
		}
		if(ctl == "ms" || complete){
			result += ",";
			result += relabs[get("msrelabs_" + index).selectedIndex] + ",";
			result += get("msthrust_" + index).dataset.code + ",";
			result += get("msfire_" + index).dataset.code + ",";
			result += get("msspcl_" + index).dataset.code;
		}
		result += ";";
	}


	console.log(result);
}

//////////////////////////
// strings for dropdown //
//////////////////////////

//http://htmlcolorcodes.com/color-names/
var colors = ["white", "snow", "honeydew", "mintcream", "azure", "aliceblue", "ghostwhite", "whitesmoke", "seashell", "beige", "oldlace", "floralwhite", "ivory", "antiquewhite", "linen", "lavenderblush", "mistyrose", "gold", "yellow", "lightyellow", "lemonchiffon", "lightgoldenrodyellow", "papayawhip", "moccasin", "peachpuff", "palegoldenrod", "khaki", "darkkhaki", "lightsalmon", "coral", "tomato", "orangered", "darkorange", "orange", "indianred", "lightcoral", "salmon", "darksalmon", "lightsalmon", "crimson", "red", "firebrick", "darkred", "pink", "lightpink", "hotpink", "deeppink", "mediumvioletred", "palevioletred", "lavender", "thistle", "plum", "violet", "orchid", "fuchsia", "magenta", "mediumorchid", "mediumpurple", "rebeccapurple", "blueviolet", "darkviolet", "darkorchid", "darkmagenta", "purple", "indigo", "slateblue", "darkslateblue", "mediumslateblue", "aqua", "cyan", "lightcyan", "paleturquoise", "aquamarine", "turquoise", "mediumturquoise", "darkturquoise", "cadetblue", "steelblue", "lightsteelblue", "powderblue", "lightblue", "skyblue", "lightskyblue", "deepskyblue", "dodgerblue", "cornflowerblue", "mediumslateblue", "royalblue", "blue", "mediumblue", "darkblue", "navy", "midnightblue", "greenyellow", "chartreuse", "lawngreen", "lime", "limegreen", "palegreen", "lightgreen", "mediumspringgreen", "springgreen", "mediumseagreen", "seagreen", "forestgreen", "green", "darkgreen", "yellowgreen", "olivedrab", "olive", "darkolivegreen", "mediumaquamarine", "darkseagreen", "lightseagreen", "darkcyan", "teal", "cornsilk", "blanchedalmond", "bisque", "navajowhite", "wheat", "burlywood", "tan", "rosybrown", "sandybrown", "goldenrod", "darkgoldenrod", "peru", "chocolate", "saddlebrown", "sienna", "brown", "maroon", "gainsboro", "lightgray", "silver", "darkgray", "gray", "dimgray", "lightslategray", "slategray", "darkslategray", "black"];

//http://skinnyms.com/50-super-foods-the-ultimate-shopping-list/
//http://bembu.com/healthy-spices-and-herbs
//https://en.wikipedia.org/wiki/List_of_micronutrients
//http://www.sixwise.com/newsletters/05/07/27/the-15-healthiest-berries-you-could-possibly-eat--including-7-most-havent-heard-of.htm
//http://www.livestrong.com/slideshow/1009507-9-healthiest-nuts-that-may-live-longer/
var names = ["Almond", "Apple", "Apricot", "Artichoke", "Asparagus", "Avocado", "Banana", "Bean", "Lentil", "Beet", "BellPepper", "Broccoli", "B-Sprout", "Cabbage", "Cantaloupe", "Carrot", "Cauliflower", "Cherry", "Chia", "Coconut", "DarkChocolate", "Flax", "Garlic", "Grape", "HotPepper", "Kale", "Kiwi", "Lemon", "Lime", "Mango", "Mushroom", "Oat", "Olive", "Orange", "Papaya", "Peach", "Pineapple", "Pumpkin", "Pomegranate", "Quinoa", "Spinach", "Spirulina", "Sprout", "SweetPotato", "SwissChard", "Tomato", "Walnut", "Turmeric", "Rosemary", "Basil", "Cumin", "Nutmeg", "Saffron", "Ginseng", "Cardamom", "Curry", "Thyme", "Cay-N-Pepper", "LicoriceRoot", "Oregano", "Cilantro", "Lavender", "Sage", "Ginger", "Cinnamon", "Parsley", "Fennel", "Boron", "Calcium", "Cobalt", "Chloride", "Chromium", "Copper", "Fluoride", "Iodine", "Iron", "Lithium", "Magnesium", "Manganese", "Molybdenum", "Phosphorus", "Potassium", "Selenium", "Sodium", "Sulfur", "Zinc", "Thiamin", "Riboflavin", "Niacin", "PantothenicAcid", "Pyridoxine", "Pyridoxal", "Pyridoxamine", "Biotin", "ErgadenylicAcid", "FolicAcid", "Cyanocobalamin", "Choline", "Retinol", "AscorbicAcid", "VitaminD", "Tocopherol", "VitaminK", "AlphaCarotene", "BetaCarotene", "Cryptoxanthin", "Lutein", "Lycopene", "Zeaxanthin", "Blueberry", "Strawberry", "Bilberry", "Blackberry", "Elderberry", "GojiBerry", "Lingonberry", "Cranberry", "Raspberry", "Dewberry", "Mulberry", "Gooseberry", "Huckleberry", "Chokeberry", "Pecan", "Pistachio", "Hazelnut", "Cashew", "Macadamia", "BrazilNut", "Peanut"];
names = names.sort();

var axespm = ["-/+ Axis 0", "+/- Axis 0", "-/+ Axis 1", "+/- Axis 1", "-/+ Axis 2", "+/- Axis 2", "-/+ Axis 3", "+/- Axis 3", "-/+ Axis 4", "+/- Axis 4", "-/+ Axis 5", "+/- Axis 5"];
var axeshalf = ["- Axis 0", "+ Axis 0", "- Axis 1", "+ Axis 1", "- Axis 2", "+ Axis 2", "- Axis 3", "+ Axis 3", "- Axis 4", "+ Axis 4", "- Axis 5", "+ Axis 5"];
var axcode = ["a+0", "a-0", "a+1", "a-1", "a+2", "a-2", "a+3", "a-3", "a+4", "a-4", "a+5", "a-5"]
var buttons = [];
var butcode = [];
for(var i=0; i<20; i++){buttons.push("Button "+i);}
for(var i=0; i<10; i++){butcode.push("b0"+i);}
for(var i=10; i<20; i++){butcode.push("b"+i);}

//https://github.com/wesbos/keycodes
var keyNames={3:"break", 8:"backspace", 9:"tab", 12:'clear',13:"enter", 16:"shift", 17:"ctrl", 18:"alt", 19:"pause", 20:"caps", 27:"esc", 32:"space", 33:"pgup", 34:"pgdn", 35:"end", 36:"home", 37:"left", 38:"up", 39:"right", 40:"down", 41:"select", 42:"print", 43:"exec", 44:"Print", 45:"insert", 46:"delete", 48:"0", 49:"1", 50:"2", 51:"3", 52:"4", 53:"5", 54:"6", 55:"7", 56:"8", 57:"9", 58:":", 59:";/=", 60:"<", 61:"=", 63:"ß", 64:"@", 65:"a", 66:"b", 67:"c", 68:"d", 69:"e", 70:"f", 71:"g", 72:"h", 73:"i", 74:"j", 75:"k", 76:"l", 77:"m", 78:"n", 79:"o", 80:"p", 81:"q", 82:"r", 83:"s", 84:"t", 85:"u", 86:"v", 87:"w", 88:"x", 89:"y", 90:"z", 96:"num0", 97:"num1", 98:"num2", 99:"num3", 100:"num4", 101:"num5", 102:"num6", 103:"num7", 104:"num8", 105:"num9", 106:"numx", 107:"num+", 108:"num.", 109:"num-", 110:"num,", 111:"num:", 112:"f1", 113:"f2", 114:"f3", 115:"f4", 116:"f5", 117:"f6", 118:"f7", 119:"f8", 120:"f9", 121:"f10", 122:"f11", 123:"f12", 124:"f13", 125:"f14", 126:"f15", 127:"f16", 128:"f17", 129:"f18", 130:"f19", 131:"f20", 132:"f21", 133:"f22", 134:"f23", 135:"f24", 144:"numlock", 145:"scrolllock", 160:"^", 161:'!',163:"#", 164:'$',165:'ù',170:'*',171:"~+*key", 186:";/ñ", 187:"=", 188:",", 189:"-", 190:".", 191:"//ç", 192:"`/ñ/æ", 193:"?,/°", 194:"num.", 219:"(", 220:"\\", 221:")", 222:"'/ø", 223:"`", 225:"altgr", 226:"</>", 231:"ç"};

</script>

<center>

<img src="media/images/darken.png" style="display:none"><!-- preloading these 2 images -->
<img src="media/images/lighten.png" style="display:none">

<img src="media/images/addplr.png" title="add player" onclick="addPlayer()" class="std" style="background-color:#77ff99">
<img src="media/images/settings.png" title="settings" onclick="" class="std" style="background-color:#3355ff">
<img src="media/images/start.png" title="start game" onclick="config2string(true)" class="std" style="background-color:#ff7755"><br>

MapURL: <input type="text" name="product" list="productName" class="std" style="width:300px; background-color:white">
<datalist id="productName">
    <option value="Pen">Pen</option>
    <option value="Pencil">Pencil</option>
    <option value="Paper">Paper</option>
</datalist>

<div id="disparea"></div>
<!--Trouble with key-presses getting ignored? Read <a href="https://www.microsoft.com/appliedsciences/antighostingexplained.mspx">this</a>!<br>
You can connect multiple keyboards to avoid this<br>
(but each player needs different keys).<br>
There are also apps for using smartphones as controllers.<br>
Just saying.
Note that some mice sneakily register as USB controllers.-->
</center>


</body></html>
